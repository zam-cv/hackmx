import{r as s}from"./index.DNi1g-pO.js";import{r as g}from"./index.DDEQXXIH.js";import{u as O,a as A}from"./check.D66-KWCr.js";function E(n,e){return s.useReducer((t,o)=>e[t][o]??t,n)}var M=n=>{const{present:e,children:t}=n,o=y(e),a=typeof t=="function"?t({present:o.isPresent}):s.Children.only(t),c=O(o.ref,P(a));return typeof t=="function"||o.isPresent?s.cloneElement(a,{ref:c}):null};M.displayName="Presence";function y(n){const[e,t]=s.useState(),o=s.useRef({}),a=s.useRef(n),c=s.useRef("none"),p=n?"mounted":"unmounted",[N,i]=E(p,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return s.useEffect(()=>{const r=d(o.current);c.current=N==="mounted"?r:"none"},[N]),A(()=>{const r=o.current,u=a.current;if(u!==n){const l=c.current,f=d(r);n?i("MOUNT"):f==="none"||r?.display==="none"?i("UNMOUNT"):i(u&&l!==f?"ANIMATION_OUT":"UNMOUNT"),a.current=n}},[n,i]),A(()=>{if(e){const r=m=>{const f=d(o.current).includes(m.animationName);m.target===e&&f&&g.flushSync(()=>i("ANIMATION_END"))},u=m=>{m.target===e&&(c.current=d(o.current))};return e.addEventListener("animationstart",u),e.addEventListener("animationcancel",r),e.addEventListener("animationend",r),()=>{e.removeEventListener("animationstart",u),e.removeEventListener("animationcancel",r),e.removeEventListener("animationend",r)}}else i("ANIMATION_END")},[e,i]),{isPresent:["mounted","unmountSuspended"].includes(N),ref:s.useCallback(r=>{r&&(o.current=getComputedStyle(r)),t(r)},[])}}function d(n){return n?.animationName||"none"}function P(n){let e=Object.getOwnPropertyDescriptor(n.props,"ref")?.get,t=e&&"isReactWarning"in e&&e.isReactWarning;return t?n.ref:(e=Object.getOwnPropertyDescriptor(n,"ref")?.get,t=e&&"isReactWarning"in e&&e.isReactWarning,t?n.props.ref:n.props.ref||n.ref)}export{M as P};
